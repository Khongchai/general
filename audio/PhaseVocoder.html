<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <audio src="tchai.wav"></audio>
    <div className="container">
      <label>Speed</label>
      <input
        type="range"
        id="speed"
        min="0.2"
        max="1.5"
        value="1"
        step="0.01"
      />
    </div>
    <button data-playing="false" role="switch" aria-checked="false">
      <span>Play/Pause</span>
    </button>
  </body>
  <script>
    /**
     * @param {Float32Array} inputs
     * @param {Float32Array} outputs
     */
    function resampleChannel(inputs, outputs) {
      for (let i = 0; i < inputs.length; i++) {
        outputs[i] = inputs[i];
      }
    }
  </script>
  <script>
    // @ts-check

    let playbackRate = 1;

    async function main() {
      const audioContext = new AudioContext();

      const audioElement = document.querySelector("audio");
      const playButton = document.querySelector("button");
      const speedControl = document.querySelector("#speed");

      if (playButton === null || speedControl === null) {
        throw new Error("Some elements were not found");
      }

      const audioData = await fetch("tchai.wav").then((response) =>
        response.arrayBuffer()
      );
      const audioBuffer = await audioContext.decodeAudioData(audioData);

      for (let i = 0; i < audioBuffer.numberOfChannels; i++) {
        const channelData = audioBuffer.getChannelData(i);
        const out = new Float32Array(channelData.length);
        resampleChannel(channelData, out);
        audioBuffer.copyToChannel(out, i);
      }

      const source = audioContext.createBufferSource();
      source.buffer = audioBuffer;
      source.connect(audioContext.destination);

      playButton.addEventListener("click", function () {
        if (this.dataset.playing === "false") {
          source.start(0);
          this.dataset.playing = "true";
        } else {
          source.stop(0);
          this.dataset.playing = "false";
        }
      });
    }

    main();
  </script>
</html>
